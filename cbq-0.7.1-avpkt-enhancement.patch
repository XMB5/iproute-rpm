--- cbq.init-v0.7.3.orig	Thu Oct  3 23:11:48 2002
+++ cbq.init-v0.7.3	Thu Oct  3 23:19:41 2002
@@ -475,6 +475,10 @@
 CBQ_WORDS="DEVICE|RATE|WEIGHT|PRIO|PARENT|LEAF|BOUNDED|ISOLATED"
 CBQ_WORDS="$CBQ_WORDS|BUFFER|LIMIT|PEAK|MTU|QUANTUM|PERTURB"
 
+### Source AVPKT if it exists
+[ -r /etc/sysconfig/cbq/avpkt ] && . /etc/sysconfig/cbq/avpkt
+AVPKT=${AVPKT:-3000}
+
 
 #############################################################################
 ############################# SUPPORT FUNCTIONS #############################
@@ -705,7 +709,7 @@
 
 	### Setup root qdisc + class for device
 	tc qdisc add dev $dev root handle 1 cbq \
-	bandwidth $DEVBWDT avpkt 1000 cell 8
+	bandwidth $DEVBWDT avpkt $AVPKT cell 8
 
 	### Set weight of the root class if set
 	[ -n "$DEVWGHT" ] &&
@@ -722,7 +726,7 @@
 	### Create the class
 	tc class add dev $DEVICE parent 1:$PARENT classid 1:$CLASS cbq \
 	bandwidth $BANDWIDTH rate $RATE weight $WEIGHT prio $PRIO \
-	allot 1514 cell 8 maxburst 20 avpkt 1000 $BOUNDED $ISOLATED ||
+	allot 1514 cell 8 maxburst 20 avpkt $AVPKT $BOUNDED $ISOLATED ||
 		cbq_fail_off "failed to add class $CLASS with parent $PARENT on $DEVICE!"
 
 	### Create leaf qdisc if set
@@ -895,7 +899,7 @@
 	### Replace CBQ class
 	tc class replace dev $DEVICE classid 1:$CLASS cbq \
 	bandwidth $BANDWIDTH rate $NEW_RATE weight $NEW_WGHT prio $PRIO \
-	allot 1514 cell 8 maxburst 20 avpkt 1000 $BOUNDED $ISOLATED
+	allot 1514 cell 8 maxburst 20 avpkt $AVPKT $BOUNDED $ISOLATED
 
 	### Replace leaf qdisc (if any)
 	if [ "$LEAF" = "tbf" ]; then
